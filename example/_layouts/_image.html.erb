<% captions = @caption.split('|', -1) %>
<%if @imgset.count > 1 %>
  <% width_limit = Config.thumbs[0] %>
  <% height_limit = Config.thumbs[1] %>
  <% style = 'display: inline-block;' %>
<% else %>
  <% width_limit = Config.thumbl[0] %>
  <% height_limit = Config.thumbl[1] %>
  <% style = '' %>
<% end %>

<% i = 0 %>
<% @imgset.each do |set| %>
  <% if set.orig.dimensions.x <= width_limit &&
      set.orig.dimensions.y <= height_limit %>

    <% thumb = false %>
    <% url = set.orig.url %>
  <% else %>
    <% thumb = true %>
    <% if @imgset.count > 1 %>
      <% url = set.thumbs.url %>
    <% else %>
      <% url = set.thumbl.url %>
    <% end %>
  <% end %>
  <!-- show thumbnail and link to modal -->
  <figure id="post-image-figure-<%= @img_id %>"
          class="post-image-figure"
          style="max-width: <%= @max_width %>; <%= style %>">
    <%= img url, class: "post-image img-no-border",
      id: "post-image-#{@img_id}",
      style: "cursor: pointer; max-width: 100%;",
      onclick: "IceBlog.openPostIMG(#{@img_id})",
      'data-url': set.orig.url,
      'data-width': set.orig.dimensions.x,
      'data-height': set.orig.dimensions.y,
      'data-id':  @img_id %>
    <% if captions[i] && !captions[i].empty? %>
      <figcaption class="post-image-hint">
        <%= captions[i] %> 
      </figcaption>
    <% end %>
  </figure>
  <% i += 1 %>
  <% @img_id += 1 %>
<% end %>
